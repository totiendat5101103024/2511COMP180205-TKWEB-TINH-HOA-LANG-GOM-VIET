<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Kết quả tìm kiếm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script src="../js/main.js"></script>
    <link rel="stylesheet" href="../css/stylesheet.css">

    <style>
        /* CSS cho thẻ kết quả */
        .result-card {
            display: flex;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            overflow: hidden;
            text-decoration: none;
            color: var(--color-text);
            transition: box-shadow 0.3s ease;
        }

        .result-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .result-card img {
            width: 120px;
            height: 120px;
            object-fit: cover;
        }

        .result-card .card-body {
            padding: 1.5rem;
        }

        .result-card .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 0.25rem;
        }

        .result-card .card-subtitle {
            color: var(--color-accent);
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .result-card .card-text {
            color: #777;
            font-size: 0.95rem;
        }
    </style>
</head>

<body>
    <nav id="main-navbar" class="navbar navbar-expand-lg fixed-top navbar-dark navbar-scrolled">
        <div class="container">
            <a class="navbar-brand" href="../index.html"><img src="../img/Logo Tinh hoa làng gốm việt.png"
                    alt="Logo"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span
                    class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Trang Chủ</a></li>
                    {/* Các mục menu khác */}
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <form class="d-flex" id="search-form" action="search-results.html">
                            <input class="form-control me-2" type="search" id="search-input" name="query"
                                placeholder="Tìm kiếm...">
                            <button class="btn btn-outline-light" type="submit"><i class="bi bi-search"></i></button>
                        </form>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="cart.html"><i class="bi bi-cart"></i></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container my-5 py-5">
        <h1 class="mb-4">Kết quả tìm kiếm cho "<span id="search-term"></span>"</h1>

        <div id="search-results-container">
            <div id="results-products" class="mb-5" style="display: none;">
                <h2>Sản phẩm</h2>
                <div id="products-list"></div>
            </div>
            <div id="results-articles" class="mb-5" style="display: none;">
                <h2>Bài viết</h2>
                <div id="articles-list"></div>
            </div>
            <div id="results-artisans" class="mb-5" style="display: none;">
                <h2>Nghệ nhân</h2>
                <div id="artisans-list"></div>
            </div>
        </div>

        <p id="no-results" class="text-center fs-4 mt-5" style="display: none;">Không tìm thấy kết quả nào phù hợp.</p>
    </main>

    <footer class="bg-dark text-white py-5">
        <div class="container text-center">
            <p>&copy; 2024 Tinh Hoa Gốm Việt.</p>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.getElementById('search-results-container');
            const productsList = document.getElementById('products-list');
            const articlesList = document.getElementById('articles-list');
            const artisansList = document.getElementById('artisans-list');
            const searchTermSpan = document.getElementById('search-term');
            const noResultsMsg = document.getElementById('no-results');

            // Lấy từ khóa tìm kiếm từ URL
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('query') || '';

            if (searchTermSpan) {
                searchTermSpan.textContent = query;
            }

            if (resultsContainer && query && typeof searchIndex !== 'undefined') {
                // Thực hiện tìm kiếm bằng Lunr.js
                const results = searchIndex.search(query);

                if (results.length > 0) {
                    noResultsMsg.style.display = 'none';

                    // Phân loại kết quả
                    const categorizedResults = { products: [], articles: [], artisans: [] };

                    results.forEach(result => {
                        const item = searchData.find(doc => doc.id === result.ref);
                        if (item) {
                            if (item.type === "Sản phẩm") categorizedResults.products.push(item);
                            else if (item.type === "Bài viết") categorizedResults.articles.push(item);
                            else if (item.type === "Nghệ nhân") categorizedResults.artisans.push(item);
                        }
                    });

                    // Hàm hiển thị kết quả cho một nhóm
                    const displayResults = (listElement, resultsArray, sectionElementId) => {
                        if (resultsArray.length > 0) {
                            document.getElementById(sectionElementId).style.display = 'block';
                            listElement.innerHTML = '';
                            resultsArray.forEach(item => {
                                const card = document.createElement('a');
                                card.href = item.url.startsWith('http') ? item.url : `../${item.url}`; // Điều chỉnh URL tương đối
                                card.className = 'result-card';
                                card.innerHTML = `
                                    <img src="${item.image.startsWith('http') ? item.image : '../' + item.image}" alt="${item.name}">
                                    <div class="card-body">
                                        <h6 class="card-subtitle">${item.type}</h6>
                                        <h5 class="card-title">${item.name}</h5>
                                        <p class="card-text">${item.description.substring(0, 100)}...</p>
                                    </div>
                                `;
                                listElement.appendChild(card);
                            });
                        } else {
                            document.getElementById(sectionElementId).style.display = 'none';
                        }
                    };

                    // Hiển thị từng nhóm kết quả
                    displayResults(productsList, categorizedResults.products, 'results-products');
                    displayResults(articlesList, categorizedResults.articles, 'results-articles');
                    displayResults(artisansList, categorizedResults.artisans, 'results-artisans');

                } else {
                    noResultsMsg.style.display = 'block';
                }
            } else if (noResultsMsg) {
                noResultsMsg.textContent = 'Vui lòng nhập từ khóa để tìm kiếm.';
                noResultsMsg.style.display = 'block';
            } else if (typeof searchIndex === 'undefined') {
                console.error("Lỗi: Biến searchIndex chưa được khởi tạo. Hãy đảm bảo main.js được tải đúng cách.");
                noResultsMsg.textContent = 'Lỗi hệ thống tìm kiếm. Vui lòng thử lại sau.';
                noResultsMsg.style.display = 'block';
            }
        });
    </script>
</body>

</html>